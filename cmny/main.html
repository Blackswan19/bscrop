<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aniq Edge | Invoice Editor</title>
    <link rel="icon" type="image/x-icon" href="logo.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { 
            font-family: 'Times New Roman', Times, serif;
            margin: 0; 
            padding: 0; 
            background-color: #f4f4f4; 
        }
        .invoice-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .invoice { 
            max-width: 800px;
            margin: 0 auto; 
            padding: 35px;
            background-color: white;
            box-sizing: border-box;
            position: relative;
            top: 0;
        }
        .logo {
            position: relative;
            top: 5px;
            left: 5px;
            float: left;
        }
        .logo img {
            width: 100px;
            height: 100px;
            display: block;
        }
        .logo img[src=""], .logo img:not([src]) {
            display: none;
        }
        h4 { 
            color: #000000;
            padding-bottom: 10px;
            margin: 5px 0px;
            font-size: 20px;
            T: right;
            font-weight: 900;
        }
        .header p { 
            font-size: 14px;
            color: #000000; 
            margin: 3px 0;
            line-height: 1.4;
        }
        .billed-to { 
            margin-top: 8px;
        }
        .billed-to label { 
            font-weight: bold; 
            color: #000000; 
            font-size: 16px;
        }
        .highlight input, .highlight textarea { 
            border: none; 
            background: #5151514a; 
            width: 100%; 
            padding: 3px;
            font-size: 14px;
            font-family: 'Times New Roman', Times, serif;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        .highlight textarea {
            resize: none;
            min-height: 80px;
            max-height: 200px; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 8px;
        }
        th, td { 
            border: 1.5px solid #ddd;
            padding: 8px;
            text-align: left; 
            font-size: 14px;
        }
        th { 
            background-color: #1c2143; 
            color: white; 
        }
        td { 
            background-color: #ecf0f1; 
        }
        .total-row td { 
            font-weight: bold; 
            background-color: #fff; 
        }
        .payment-info { 
            background-color: #1c2143;
            color: white; 
            padding: 20px;
            margin-top: 8px;
            font-size: 14px;
            border-radius: 0px;
            page-break-inside: avoid;
        }
        .payment-info h3 { 
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .payment-row { 
            display: flex;
            align-items: center;
            margin-bottom: 0px;
        }
        input {
            outline: none;
        }
        .payment-row label { 
            min-width: 150px;
            font-weight: bold; 
        }
        .payment-row .colon { 
            margin: 0 10px;
        }
        .payment-row .highlight { 
            background-color: transparent;
        }
        .payment-row .highlight input { 
            background-color: #ffffff; 
            padding: 3px; 
            color: #000; 
        }
        .payment-row .highlight input:focus {
            background-color: #3b82f6;
        }
        .payment-info p:last-child { 
            margin-top: 12px;
        }
        .filename-input { 
            margin-top: 8px;
            font-size: 14px;
        }
        .filename-input label { 
            font-weight: bold; 
            color: #1c2143; 
        }
        .filename-input input { 
            padding: 5px;
            font-size: 14px;
            width: 200px;
        }
        .download-section { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin-top: 8px;
        }
        button { 
            background-color: #1c2143; 
            color: white; 
            padding: 8px 16px;
            border: none; 
            cursor: pointer; 
            font-size: 14px;
        }
        button:hover { 
            background-color: #3b82f6; 
        }
        @media print {
            body { 
                margin: 0; 
                padding: 0; 
            }
            .invoice-wrapper {
                min-height: auto;
            }
            .invoice { 
                margin: 0; 
                padding: 5px;
                border: none; 
                box-shadow: none; 
            }
            .logo {
                position: static;
                margin-bottom: 10px;
                display: flex;
            }
            .logo img {
                width: 100px;
                height: 50px;
                display: block;
            }
            .logo img[src=""], .logo img:not([src]) {
                display: none;
            }
            .logo:empty + h2 {
                margin-top: 10px !important;
            }
            .highlight { 
                background-color: transparent !important; 
            }
            .highlight input, .highlight textarea { 
                background-color: transparent !important; 
                border: none !important; 
                padding: 0; 
            }
            .highlight div {
                background-color: transparent !important;
                white-space: pre-wrap;
                line-height: 1.4;
                font-size: 14px;
                font-family: 'Times New Roman', Times, serif;
            }
            button { 
                display: none !important; 
            }
            .filename-input { 
                display: none !important; 
            }
            .payment-row .highlight input { 
                background-color: transparent !important; 
                color: #000 !important; 
            }
            .download-section span { 
                font-size: 14px;
                color: #1c2143; 
            }
            .payment-info {
                page-break-before: auto;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-wrapper">
        <div class="invoice">
            <div class="logo">
                <img src="logo.png" alt="Logo">
            </div>
            <h4>INVOICE</h4>
            <div class="header" style="text-align: right; width: -webkit-fill-available;">
                <div class="mydetails" style="text-align: right;">
                    <p><strong>Merugu Anirudh</strong><br>
                    1-127/4, Srinivasa Nagar, Nizamabad, Telangana, 503002<br>
                    90634 03164, aniqedge@gmail.com </p>
                    <hr>
                </div>
                <p>Invoice Date: <span class="highlight"><input type="text" id="invoiceDate" value="29-June-2025" style="width:120px;"></span> | Invoice No: <span class="highlight"><input type="text" id="invoiceNo" value="202507002" style="width:120px;"></span><br>
                Due Date: <span class="highlight"><input type="text" id="dueDate" value="01-July-2025" style="width:120px;"></span></p>
            </div>
            <div class="billed-to">
                <label>Billed to:</label><br>
                <span class="highlight">
                    <textarea id="billedCompany" style="width: 500px;">CYD EDUCATION CONSULTANCY Pvt. Ltd.
Mr. Kamalla
BESAID MNM HP PETROLEUM, 19-3-3B,
Renigunta Rd, Korramenugunta,
Tirupati, Andhra Pradesh 517501</textarea>
                </span>
            </div>
            <br>
            <table>
                <tr>
                    <th>#</th>
                    <th>Description</th>
                    <th>Qty</th>
                    <th>Amount</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td><span class="highlight"><input type="text" id="description" value="Performance Marketing Services (1st July 2025 to 31st July)" style="width:400px;"></span></td>
                    <td><span class="highlight"><input type="number" id="qty" value="1" style="width:60px;"></span></td>
                    <td><span class="highlight"><input type="number" id="amount" value="20000.00" style="width:120px;"></span></td>
                </tr>
                <tr class="total-row">
                    <td colspan="3"><strong>Total Due (INR)</strong></td>
                    <td><span id="total">20000.00</span></td>
                </tr>
            </table>
            <br>
            <div class="payment-info">
                <h3>PAYMENT INFORMATION:</h3>
                <div class="payment-row">
                    <label>Amount (INR)</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="number" id="payAmount" value="20000.00" style="width:120px;"></span>
                </div>
                <div class="payment-row">
                    <label>Bank Account Name</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="text" id="bankName" value="Merugu Anirudh" style="width:250px;"></span>
                </div>
                <div class="payment-row">
                    <label>Bank Account No.</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="text" id="accountNo" value="5010036458201" style="width:180px;"></span>
                </div>
                <div class="payment-row">
                    <label>Bank Name</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="text" id="bank" value="HDFC" style="width:120px;"></span>
                </div>
                <div class="payment-row">
                    <label>IFSC</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="text" id="ifsc" value="HDFC0003059" style="width:120px;"></span>
                </div>
                <div class="payment-row">
                    <label>GPay/PhonePe</label>
                    <span class="colon">:</span>
                    <span class="highlight"><input type="text" id="gpay" value="9502055949" style="width:120px;"></span>
                </div>
                <p>Note: We kindly request that the payment be completed by [ Due Date: <span class="highlight"><input type="text" id="dueDateNote" value="01-July-2025" style="width:120px; background: white;"></span>] to ensure smooth continuity of service and operations.</p>
            </div>
            <br><br><br><br>
            <div class="filename-input">
                <label for="filename">PDF Filename:</label>
                <input type="text" id="filename" value="invoice" placeholder="Enter filename">
            </div>
            <div class="download-section">
                <span id="error-message" style="color: red;"></span>
                <button onclick="generatePDF()">Download PDF</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const logoImg = document.querySelector('.logo img');
            if (logoImg) {
                logoImg.addEventListener('error', () => {
                    logoImg.parentElement.style.display = 'none';
                    document.querySelector('h4').style.marginTop = '10px';
                    displayError('API address error: Failed to load logo image.');
                });
            } else {
                document.querySelector('.logo').style.display = 'none';
                document.querySelector('h4').style.marginTop = '10px';
            }

            // Check if html2pdf.js is loaded
            if (typeof html2pdf === 'undefined') {
                displayError('API address error: PDF generation library not loaded.');
                const downloadButton = document.querySelector('button');
                if (downloadButton) downloadButton.disabled = true;
            }
        });

        function displayError(message) {
            const errorElement = document.getElementById('error-message');
            if (errorElement) {
                errorElement.textContent = message;
            } else {
                alert(message);
            }
            console.error(message);
        }

        function generatePDF() {
            try {
                const element = document.querySelector('.invoice');
                if (!element) {
                    displayError('Error: Invoice element not found.');
                    return;
                }

                const logoImg = document.querySelector('.logo img');
                let logoLoaded = true;
                if (logoImg) {
                    logoLoaded = logoImg.complete && logoImg.naturalHeight !== 0;
                    if (!logoLoaded) {
                        displayError('API address error: Logo image failed to load.');
                    }
                }

                const qty = parseFloat(document.getElementById('qty').value) || 0;
                const amount = parseFloat(document.getElementById('amount').value) || 0;
                const total = qty * amount;
                document.getElementById('total').textContent = isNaN(total) ? '0.00' : total.toFixed(2);

                const clonedElement = element.cloneNode(true);

                if (!logoLoaded) {
                    const clonedLogo = clonedElement.querySelector('.logo');
                    if (clonedLogo) clonedLogo.style.display = 'none';
                    const clonedH4 = clonedElement.querySelector('h4');
                    if (clonedH4) clonedH4.style.marginTop = '10px';
                }

                const button = clonedElement.querySelector('button');
                if (button) button.remove();
                const filenameInput = clonedElement.querySelector('.filename-input');
                if (filenameInput) filenameInput.remove();

                clonedElement.querySelectorAll('.highlight').forEach(highlight => {
                    highlight.style.backgroundColor = 'transparent';
                    const input = highlight.querySelector('input');
                    const textarea = highlight.querySelector('textarea');
                    if (input) {
                        const value = input.value || '';
                        highlight.innerHTML = value;
                    } else if (textarea) {
                        const value = textarea.value || '';
                        const div = document.createElement('div');
                        div.style.whiteSpace = 'pre-wrap';
                        div.style.lineHeight = '1.4';
                        div.style.fontSize = '14px';
                        div.style.fontFamily = '"Times New Roman", Times, serif';
                        div.textContent = value;
                        highlight.innerHTML = '';
                        highlight.appendChild(div);
                    }
                });

                const filenameValue = document.getElementById('filename').value.trim();
                const filename = filenameValue ? `${filenameValue}.pdf` : 'invoice.pdf';

                if (typeof html2pdf === 'undefined') {
                    displayError('API address error: PDF generation library not loaded.');
                    return;
                }

                html2pdf().from(clonedElement).set({
                    margin: [10, 10, 10, 10],
                    filename: filename,
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait', 
                        compress: false 
                    },
                    html2canvas: { 
                        scale: 2,
                        dpi: 192,
                        logging: true,
                        useCORS: true
                    },
                    autoPaging: 'text'
                }).save().catch(error => {
                    displayError(`API address error: Failed to generate PDF - ${error.message}`);
                });
            } catch (error) {
                displayError(`API address error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
